<div class="page-title mat-elevation-z0">
    <h1>Nouvelle recette</h1>
</div>

<div class="page-container create-container">
    <br>
    <mat-card class="mat-elevation-z6">
        <img class="recipe-img" mat-card-image [src]="imagePath || defaultImage">
        <mat-card-content>
            <form [formGroup]="form" (ngSubmit)="onSubmit(form.value)">

                <span class="section">
                    <span class="section-title">
                        <mat-icon>assignment</mat-icon>
                        <h3>General informations</h3>
                    </span>
                    <span class="section-subtitle">
                        Informations describing at best the recipe you are adding
                    </span>
                </span> 
                <mat-form-field class="input" appearance="outline">
                    <mat-label>Title</mat-label>
                    <mat-icon matSuffix color="primary">title</mat-icon>
                    <input matInput formControlName="title">
                </mat-form-field>
                <br>
                <mat-form-field class="input" appearance="outline">
                    <mat-label>Description</mat-label>
                    <mat-icon matSuffix color="primary">subtitles</mat-icon>
                    <textarea matInput matTextareaAutosize matAutosizeMinRows=2
                        formControlName="description"></textarea>
                </mat-form-field>
                <br>
                <!-- TAGS -->
                <mat-form-field class="input" appearance="outline">
                    <mat-label>Tags</mat-label>
                    <mat-icon matSuffix color="primary">local_offer</mat-icon>
                    <mat-chip-list #chipList aria-label="Tag selection">
                        <mat-chip *ngFor="let tag of selectedTags" [selectable]="true" [removable]="true"
                            (removed)="remove(tag)">
                            {{tag.name}}
                            <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                        <input placeholder="Tags" #tagInput [formControl]="tagCtrl" [matAutocomplete]="auto"
                            [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                            (matChipInputTokenEnd)="add($event)">
                    </mat-chip-list>
                    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
                        <mat-option *ngFor="let tag of filteredTags | async" [value]="tag.name">
                            {{tag.name}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
                <!-- IMAGE -->
                <mat-form-field class="input" appearance="outline">
                    <mat-label>Image</mat-label>
                    <mat-icon matSuffix color="primary">add_photo_alternate</mat-icon>
                    <input matInput placeholder="http://" formControlName="imagePath" [(ngModel)]="imagePath">
                </mat-form-field>

                <!-- INGREDIENTS -->
                <span class="section">
                    <span class="section-title">
                        <mat-icon>kitchen</mat-icon>
                        <h3>Ingredients</h3>
                    </span>
                    <span class="section-subtitle">
                        List the ingredients and their quantity
                    </span>
                </span>
                <div cdkDropList class="steps-list">
                    <div fxLayout="row" fxLayoutGap="10px" *ngFor="let ingredient of ingredients; let i = index">
                        <div fxFlex="0 0 80px" fxFlexAlign="center">
                            <mat-form-field class="input" appearance="outline">
                                <mat-label>Quantity</mat-label>
                                <input matInput type="number" min="0" max="99" [ngModelOptions]="{standalone: true}" [(ngModel)]="ingredient.quantity" placeholder="1">
                            </mat-form-field>
                        </div>
                        <div fxFlex="0 0 90px" fxFlexAlign="center">
                            <mat-form-field class="input" appearance="outline">
                                <mat-label>Unit</mat-label>
                                <mat-select [(value)]="ingredient.unit">
                                  <mat-option *ngFor="let unit of quantityUnits" [value]="unit">{{unit}}</mat-option>
                                </mat-select>
                              </mat-form-field>
                        </div>
                        <div fxFlex>
                            <mat-form-field class="input" appearance="outline">
                                <mat-label>Ingredient</mat-label>
                                <input matInput type="text" maxlength="249" [ngModelOptions]="{standalone: true}" [(ngModel)]="ingredient.name" placeholder="Ingredient">
                            </mat-form-field>
                        </div>
                        <div fxFlex="0 0 40px" fxFlexAlign="center">
                            <button mat-icon-button (click)="delete_ingredient(i)" alt="Delete an ingredient" type="button">
                                <mat-icon color="warn">delete</mat-icon>
                            </button>
                        </div>
                    </div>
                </div>
                <a mat-raised-button (click)="add_ingredient()" style="margin-left:46px;margin-top:10px;">
                    <mat-icon color="primary">add_box</mat-icon>
                    Ingredient
                </a>


                <!-- STEPS -->
                <span class="section">
                    <span class="section-title">
                        <mat-icon>list</mat-icon>
                        <h3>Steps</h3>
                    </span>
                    <span class="section-subtitle">
                        Organize your recipe's steps (add, change the order, remove)
                    </span>
                </span>
                <div cdkDropList class="steps-list" (cdkDropListDropped)="drop_step($event)">
                    <div class="move" *ngFor="let step of steps; let i = index" cdkDrag><!-- we put a div above all otherwise display: flex is gone after a drag-drop -->
                        <div fxLayout="row" fxLayoutGap="10px">
                            <div fxFlex="0 0 40px" fxFlexAlign="center">
                                <mat-icon cdkDragHandle color="primary" style="cursor: move;">open_with</mat-icon>
                            </div>
                            <div fxFlex>
                                <mat-form-field class="input" appearance="outline">
                                    <mat-label>Step {{i + 1}}</mat-label>
                                    <textarea matInput matTextareaAutosize matAutosizeMinRows=2 [ngModelOptions]="{standalone: true}" [(ngModel)]="step.content"></textarea>
                                </mat-form-field>
                            </div>
                            <div fxFlex="0 0 40px" fxFlexAlign="center">
                                <button mat-icon-button (click)="delete_step(i)" alt="Delete a step" type="button"><mat-icon color="warn">delete</mat-icon></button>
                            </div>
                        </div>
                    </div>
                </div>
                <a mat-raised-button (click)="add_step(steps.length)" style="margin-left:46px;margin-top:10px;">
                    <mat-icon color="primary">add_box</mat-icon>
                    Step
                </a>
                <br><br>
                <mat-divider></mat-divider>
                <div style="margin-top: 20px; text-align: right;">
                    <button mat-stroked-button color="warn" type="button">
                        <mat-icon inline>cancel</mat-icon>
                        Annuler
                    </button>
                    &nbsp;&nbsp;
                    <button mat-stroked-button color="primary" type="submit">
                        <mat-icon inline>add_circle</mat-icon>
                        Ajouter
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</div>